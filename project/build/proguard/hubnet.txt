-include common.txt

# this keeps scala stuff from being obfuscated.
# i was having a lot of trouble getting the applet to work without it.
-dontobfuscate

# since this file is in the project/build/proguard directory, we need to get back up to the root
-basedirectory ../../..

# pulling in ordinary Scala objects costs very little in size, but
# when we starting pulling in stuff from the Scala standard library,
# the costs escalate somewhat, so be careful - ST 2/21/09, 8/12/09
-injars project/boot/scala-2.9.0-1/lib/scala-library.jar

-injars target/scala_2.9.0-1/classes

-injars resources(!**.svn**,!images/shapes-editor/**,!system/libraryShapes.txt,!system/about.txt,!system/library.html,!system/empty.nlogo3d,!system/behaviorspace.dtd,!system/dict3d.txt,!system/dict.txt,!system/info.css,!i18n/**,!images/title.jpg,**)


-outjar HubNet.jar


# ProGuard doc recommends keeping Exceptions,InnerClasses,Signature
# for libraries.  we keep SourceFile and LineNumberTable so we get
# nice stack traces.  but we get significant space savings (10% or so)
# by not keeping ScalaSignature - ST 5/13/11
-keepnames class * { *; }
-keepattributes Exceptions,InnerClasses,Signature,SourceFile,LineNumberTable

-keep public class scala.ScalaObject {
  *;
}

-keep public class org.nlogo.hubnet.client.App {
     public static void main(...);
}

# this alternate main method isn't used in production, but we use it in testing sometimes
-keep public class org.nlogo.hubnet.client.ClientApplet {
     public static void main(...);
}

# the Event stuff works by reflection so we need to explicitly include these
-keep public class * extends org.nlogo.window.Event

# this is a bit of magic needed to make Java enums work, taken from the ProGuard manual
-keepclassmembers enum * {
    public static **[] values();
    public static ** valueOf(java.lang.String);
}

# HubNet uses java.io.Serializable, so we need this, taken from the ProGuard manual
# http://proguard.sourceforge.net/index.html#/manual/examples.html#serializable
# this is what I needed to avoid weird serialversionuid issues. -JC 7/15/2011
-keepclassmembers class * implements java.io.Serializable {
    static final long serialVersionUID;
    private static final java.io.ObjectStreamField[] serialPersistentFields;
    !static !transient <fields>;
    !private <fields>;
    !private <methods>;
    private void writeObject(java.io.ObjectOutputStream);
    private void readObject(java.io.ObjectInputStream);
    java.lang.Object writeReplace();
    java.lang.Object readResolve();
}

-keep public class org.nlogo.hubnet.mirroring.* {
 *;
}

-keep public class org.nlogo.widget.* {
 *;
}

# needed or extensions written in Scala won't build
-keep class scala.reflect.ScalaSignature {
    *;
}
